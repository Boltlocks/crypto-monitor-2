<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crypto Fear & Greed Monitor</title>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Unbounded:wght@300;600;800&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-dark: #0a0a0f;
      --bg-card: #14141f;
      --accent-fear: #ef4444;
      --accent-greed: #10b981;
      --accent-neutral: #6366f1;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --border: #1e293b;
    }

    body {
      font-family: 'Space Mono', monospace;
      background: var(--bg-dark);
      color: var(--text-primary);
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background:
        radial-gradient(circle at 20% 30%, rgba(239, 68, 68, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(16, 185, 129, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .app { position: relative; z-index: 1; min-height: 100vh; padding: 2rem; }

    header { text-align: center; margin-bottom: 2rem; animation: fadeIn 0.8s ease-out; }

    h1 {
      font-family: 'Unbounded', cursive;
      font-size: 3.2rem;
      font-weight: 800;
      background: linear-gradient(135deg, #ef4444 0%, #6366f1 50%, #10b981 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
    }

    .subtitle {
      color: var(--text-secondary);
      font-size: 1rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    .dashboard {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      animation: fadeIn 0.8s ease-out 0.2s backwards;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 2rem;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-fear), var(--accent-neutral), var(--accent-greed));
    }

    .card-title {
      font-family: 'Unbounded', cursive;
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1.25rem;
      color: var(--text-primary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      text-align: center;
    }

    .index-value {
      font-family: 'Unbounded', cursive;
      font-size: 5rem;
      font-weight: 800;
      line-height: 1;
      margin-top: 0.5rem;
      text-align: center;
    }

    .index-label {
      margin-top: 0.6rem;
      font-weight: 800;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      text-align: center;
    }

    .meta-row {
      margin-top: 0.6rem;
      color: var(--text-secondary);
      font-size: 0.95rem;
      text-align: center;
    }

    .gauge-container {
      width: 100%;
      max-width: 760px;
      height: 44px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(148, 163, 184, 0.15);
      border-radius: 999px;
      margin: 1.25rem auto 0;
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 0 20px rgba(0,0,0,0.45);
    }

    .gauge-gradient {
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, var(--accent-fear), #f59e0b, var(--accent-greed));
      opacity: 1;
    }

    .gauge-marker {
      position: absolute;
      top: 50%;
      width: 4px;
      height: 58px;
      background: rgba(255,255,255,0.95);
      transform: translate(-2px, -50%);
      border-radius: 2px;
      box-shadow: 0 0 12px rgba(255,255,255,0.55);
      pointer-events: none;
    }

    .gauge-cap {
      position: absolute;
      inset: 0;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.0));
      pointer-events: none;
    }

    .chart-wrap {
      position: relative;
      width: 100%;
      height: 380px;
      margin-top: 1.5rem;
    }

    .price-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 0.5rem;
    }

    .price-item {
      padding: 1rem;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 10px;
      border-left: 3px solid var(--accent-neutral);
    }

    .price-label { font-weight: 700; color: var(--text-secondary); font-size: 0.9rem; }
    .price-value { font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem; }
    .price-change { font-size: 0.9rem; margin-top: 0.35rem; }
    .positive { color: var(--accent-greed); }
    .negative { color: var(--accent-fear); }

    .alert-zones {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    .zone {
      padding: 1.25rem;
      border-radius: 10px;
      text-align: center;
      border: 2px solid;
      transition: all 0.3s ease;
    }

    .zone.active { animation: glow 2s ease-in-out infinite; }

    .zone-fear { border-color: var(--accent-fear); background: rgba(239, 68, 68, 0.1); }
    .zone-greed { border-color: var(--accent-greed); background: rgba(16, 185, 129, 0.1); }

    .zone-title { font-weight: 700; margin-bottom: 0.5rem; font-size: 1.05rem; }
    .zone-range { font-size: 0.9rem; color: var(--text-secondary); }

    .loading {
      text-align: center;
      padding: 4rem;
      font-size: 1.2rem;
      color: var(--text-secondary);
    }

    .error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid var(--accent-fear);
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
      color: var(--accent-fear);
      max-width: 900px;
      margin: 0 auto 1.5rem;
    }

    .last-updated {
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.8rem;
      margin-top: 2rem;
      letter-spacing: 0.05em;
    }

    .note {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(99, 102, 241, 0.08);
      border: 1px solid rgba(99, 102, 241, 0.25);
      border-radius: 10px;
      font-size: 0.9rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes glow {
      0%, 100% { box-shadow: 0 0 10px currentColor; }
      50% { box-shadow: 0 0 20px currentColor, 0 0 30px currentColor; }
    }

    @media (max-width: 900px) {
      .grid-2 { grid-template-columns: 1fr; }
      h1 { font-size: 2.1rem; }
      .price-grid { grid-template-columns: 1fr; }
      .index-value { font-size: 4.2rem; }
      .chart-wrap { height: 320px; }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useRef, useState } = React;

    function money(n) {
      if (typeof n !== "number") return null;
      return n.toLocaleString("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function pct(n) {
      if (typeof n !== "number") return null;
      return `${Math.abs(n).toFixed(2)}%`;
    }

    function clamp(n, min, max) {
      return Math.min(max, Math.max(min, n));
    }

    function getIndexColor(value) {
      const v = Number(value);
      if (!Number.isFinite(v)) return "#6366f1";
      if (v <= 25) return "#ef4444";
      if (v <= 45) return "#f59e0b";
      if (v <= 55) return "#6366f1";
      if (v <= 75) return "#10b981";
      return "#10b981";
    }

    function App() {
      const [fgHistory, setFgHistory] = useState([]);
      const [fgLatest, setFgLatest] = useState(null);
      const [cryptoPrices, setCryptoPrices] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [lastUpdate, setLastUpdate] = useState(null);

      const fgChartRef = useRef(null);
      const fgChartInstance = useRef(null);

      const fetchFearGreedHistory = async () => {
        const url = "https://api.alternative.me/fng/?limit=2000&format=json";
        const res = await fetch(url);
        if (!res.ok) throw new Error("Fear and Greed fetch failed");
        const data = await res.json();
        const rows = (data?.data || []).slice().reverse();
        setFgHistory(rows);
        setFgLatest(rows.length ? rows[rows.length - 1] : null);
      };

      const fetchCryptoPrices = async () => {
        const url = "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd&include_24hr_change=true";
        const res = await fetch(url);
        if (!res.ok) throw new Error("Crypto price fetch failed");
        const data = await res.json();
        setCryptoPrices(data);
      };

      const fetchAll = async () => {
        setError(null);
        setLoading(true);
        try {
          await Promise.all([fetchFearGreedHistory(), fetchCryptoPrices()]);
          setLastUpdate(new Date());
        } catch (e) {
          setError(e?.message || "Failed to load data");
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        fetchAll();
        const t = setInterval(fetchAll, 300000);
        return () => clearInterval(t);
      }, []);

      const fgValue = useMemo(() => {
        const v = Number(fgLatest?.value);
        return Number.isFinite(v) ? v : 50;
      }, [fgLatest]);

      const fgClassification = fgLatest?.value_classification || "Neutral";

      const fg7dChange = useMemo(() => {
        if (!fgHistory.length) return null;

        const latest = Number(fgHistory[fgHistory.length - 1]?.value);
        if (!Number.isFinite(latest)) return null;

        const nowTs = Number(fgHistory[fgHistory.length - 1]?.timestamp) * 1000;
        if (!Number.isFinite(nowTs)) return null;

        const targetTs = nowTs - 7 * 24 * 60 * 60 * 1000;

        let idx = -1;
        for (let i = fgHistory.length - 1; i >= 0; i--) {
          const ts = Number(fgHistory[i]?.timestamp) * 1000;
          if (Number.isFinite(ts) && ts <= targetTs) {
            idx = i;
            break;
          }
        }
        if (idx === -1) return null;

        const old = Number(fgHistory[idx]?.value);
        if (!Number.isFinite(old)) return null;

        return latest - old;
      }, [fgHistory]);

      const indexColor = getIndexColor(fgValue);

      const btc = {
        price: cryptoPrices?.bitcoin?.usd,
        change: cryptoPrices?.bitcoin?.usd_24h_change
      };

      const eth = {
        price: cryptoPrices?.ethereum?.usd,
        change: cryptoPrices?.ethereum?.usd_24h_change
      };

      const daysShown = fgHistory.length;

      useEffect(() => {
        if (!fgChartRef.current) return;
        if (!fgHistory.length) return;

        const labels = fgHistory.map((d) => {
          const ts = Number(d.timestamp) * 1000;
          const dt = Number.isFinite(ts) ? new Date(ts) : new Date();
          return dt.toLocaleDateString(undefined, { year: "2-digit", month: "short" });
        });

        const values = fgHistory.map((d) => {
          const v = Number(d.value);
          return Number.isFinite(v) ? v : null;
        });

        if (fgChartInstance.current) {
          fgChartInstance.current.destroy();
          fgChartInstance.current = null;
        }

        fgChartInstance.current = new Chart(fgChartRef.current, {
          type: "line",
          data: {
            labels,
            datasets: [{
              label: "Fear & Greed",
              data: values,
              tension: 0.25,
              borderWidth: 2,
              pointRadius: 0,
              borderColor: "rgba(241, 245, 249, 0.90)",
              fill: false
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: { mode: "index", intersect: false }
            },
            interaction: { mode: "index", intersect: false },
            scales: {
              y: {
                min: 0,
                max: 100,
                grid: { color: "rgba(148, 163, 184, 0.12)" },
                ticks: { color: "rgba(148, 163, 184, 0.9)" }
              },
              x: {
                grid: { display: false },
                ticks: {
                  color: "rgba(148, 163, 184, 0.9)",
                  maxTicksLimit: 10
                }
              }
            }
          }
        });
      }, [fgHistory]);

      if (loading) {
        return (
          <div className="app">
            <div className="loading">Loading crypto data...</div>
          </div>
        );
      }

      const markerLeft = `${clamp(fgValue, 0, 100)}%`;

      return (
        <div className="app">
          <header>
            <h1>Crypto Fear & Greed</h1>
            <p className="subtitle">Sentiment plus BTC and ETH snapshot</p>
          </header>

          {error && <div className="error">{error}</div>}

          <div className="dashboard">
            <div className="card">
              <h2 className="card-title">Fear & Greed Index</h2>

              <div className="index-value" style={{ color: indexColor }}>
                {fgValue}
              </div>

              <div className="index-label" style={{ color: indexColor }}>
                {fgClassification}
              </div>

              <div className="meta-row">
                7D change{" "}
                <span style={{ color: fg7dChange === null ? "var(--text-secondary)" : (fg7dChange >= 0 ? "#10b981" : "#ef4444"), fontWeight: 700 }}>
                  {fg7dChange === null ? "N/A" : `${fg7dChange >= 0 ? "+" : ""}${fg7dChange.toFixed(0)}`}
                </span>
              </div>

              <div className="gauge-container" aria-label="Fear and Greed gauge">
                <div className="gauge-gradient"></div>
                <div className="gauge-marker" style={{ left: markerLeft }}></div>
                <div className="gauge-cap"></div>
              </div>

              <div className="chart-wrap">
                <canvas ref={fgChartRef}></canvas>
              </div>

              <div className="note">
                Showing {daysShown} days of history. If you do not see five years here, it means the public API capped the response size in the browser.
              </div>
            </div>

            <div className="grid-2">
              <div className="card">
                <h2 className="card-title">BTC and ETH</h2>

                <div className="price-grid">
                  <div className="price-item">
                    <div className="price-label">BTC</div>
                    <div className="price-value">
                      {btc.price == null ? "N/A" : `$${money(btc.price)}`}
                    </div>
                    <div className={`price-change ${(btc.change ?? 0) >= 0 ? "positive" : "negative"}`}>
                      {(btc.change ?? 0) >= 0 ? "‚ñ≤" : "‚ñº"} {pct(btc.change) ?? "N/A"}
                    </div>
                  </div>

                  <div className="price-item">
                    <div className="price-label">ETH</div>
                    <div className="price-value">
                      {eth.price == null ? "N/A" : `$${money(eth.price)}`}
                    </div>
                    <div className={`price-change ${(eth.change ?? 0) >= 0 ? "positive" : "negative"}`}>
                      {(eth.change ?? 0) >= 0 ? "‚ñ≤" : "‚ñº"} {pct(eth.change) ?? "N/A"}
                    </div>
                  </div>
                </div>

                <div className="note">
                  This page pulls live spot prices. If CoinGecko rate limits you on GitHub Pages, we can switch to a cached JSON file later.
                </div>
              </div>

              <div className="card">
                <h2 className="card-title">Alert zones</h2>

                <div className="alert-zones">
                  <div className={`zone zone-fear ${fgValue <= 20 ? "active" : ""}`}>
                    <div className="zone-title">üö® EXTREME FEAR</div>
                    <div className="zone-range">20 and below</div>
                    <div style={{ marginTop: "0.5rem", fontSize: "0.8rem" }}>BUY NOW</div>
                  </div>

                  <div className={`zone zone-greed ${fgValue >= 80 ? "active" : ""}`}>
                    <div className="zone-title">üö® EXTREME GREED</div>
                    <div className="zone-range">80 and above</div>
                    <div style={{ marginTop: "0.5rem", fontSize: "0.8rem" }}>SELL NOW</div>
                  </div>

                  <div className={`zone zone-fear ${fgValue <= 25 && fgValue > 20 ? "active" : ""}`}>
                    <div className="zone-title">‚ö†Ô∏è Fear</div>
                    <div className="zone-range">21 to 25</div>
                    <div style={{ marginTop: "0.5rem", fontSize: "0.8rem" }}>Prepare to buy</div>
                  </div>

                  <div className={`zone zone-greed ${fgValue >= 75 && fgValue < 80 ? "active" : ""}`}>
                    <div className="zone-title">‚ö†Ô∏è Greed</div>
                    <div className="zone-range">75 to 79</div>
                    <div style={{ marginTop: "0.5rem", fontSize: "0.8rem" }}>Prepare to sell</div>
                  </div>
                </div>

                <div className="note">
                  These match your monitor.py thresholds.
                </div>
              </div>
            </div>

            {lastUpdate && (
              <div className="last-updated">
                Last updated {lastUpdate.toLocaleString()}
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
